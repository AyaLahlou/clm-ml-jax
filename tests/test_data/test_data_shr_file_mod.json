{
  "function_name": "file_unit_management",
  "test_cases": [
    {
      "name": "test_create_initial_state",
      "function": "create_initial_file_unit_state",
      "inputs": {},
      "expected_output": {
        "unit_tag_shape": [
          100
        ],
        "unit_tag_all_false": true,
        "unit_tag_dtype": "bool"
      },
      "metadata": {
        "type": "nominal",
        "description": "Tests creation of initial file unit state with all units available",
        "edge_cases": []
      }
    },
    {
      "name": "test_get_unit_auto_allocation_from_empty",
      "function": "shr_file_get_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": null
      },
      "expected_output": {
        "allocated_unit": 99,
        "success": true,
        "unit_tag_at_99": true
      },
      "metadata": {
        "type": "nominal",
        "description": "Tests automatic unit allocation from empty state, should return highest available unit (99)",
        "edge_cases": []
      }
    },
    {
      "name": "test_get_specific_unit_available",
      "function": "shr_file_get_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": 42
      },
      "expected_output": {
        "allocated_unit": 42,
        "success": true,
        "unit_tag_at_42": true
      },
      "metadata": {
        "type": "nominal",
        "description": "Tests requesting a specific available unit number",
        "edge_cases": []
      }
    },
    {
      "name": "test_get_unit_boundary_min",
      "function": "shr_file_get_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": 10
      },
      "expected_output": {
        "allocated_unit": 10,
        "success": true,
        "unit_tag_at_10": true
      },
      "metadata": {
        "type": "edge",
        "description": "Tests allocation at minimum valid unit boundary (SHR_FILE_MIN_UNIT = 10)",
        "edge_cases": [
          "boundary_min"
        ]
      }
    },
    {
      "name": "test_get_unit_boundary_max",
      "function": "shr_file_get_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": 99
      },
      "expected_output": {
        "allocated_unit": 99,
        "success": true,
        "unit_tag_at_99": true
      },
      "metadata": {
        "type": "edge",
        "description": "Tests allocation at maximum valid unit boundary (SHR_FILE_MAX_UNIT = 99)",
        "edge_cases": [
          "boundary_max"
        ]
      }
    },
    {
      "name": "test_get_unit_reserved_stdin",
      "function": "shr_file_get_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": 5
      },
      "expected_output": {
        "allocated_unit": -1,
        "success": false,
        "unit_tag_unchanged": true
      },
      "metadata": {
        "type": "edge",
        "description": "Tests attempting to allocate reserved unit 5 (stdin), should fail",
        "edge_cases": [
          "reserved_unit"
        ]
      }
    },
    {
      "name": "test_get_unit_already_allocated",
      "function": "shr_file_get_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": 75
      },
      "expected_output": {
        "allocated_unit": -1,
        "success": false,
        "unit_tag_at_75": true
      },
      "metadata": {
        "type": "edge",
        "description": "Tests attempting to allocate a unit that is already in use",
        "edge_cases": [
          "already_allocated"
        ]
      }
    },
    {
      "name": "test_get_unit_auto_with_partial_allocation",
      "function": "shr_file_get_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            true,
            true
          ]
        },
        "unit": null
      },
      "expected_output": {
        "allocated_unit": 89,
        "success": true,
        "unit_tag_at_89": true
      },
      "metadata": {
        "type": "special",
        "description": "Tests auto-allocation when high units (90-99) are taken, should return 89",
        "edge_cases": []
      }
    },
    {
      "name": "test_free_unit_success",
      "function": "shr_file_free_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": 75
      },
      "expected_output": {
        "error_code": 0,
        "error_msg": "",
        "unit_tag_at_75": false
      },
      "metadata": {
        "type": "nominal",
        "description": "Tests successfully freeing an allocated unit",
        "edge_cases": []
      }
    },
    {
      "name": "test_free_unit_reserved",
      "function": "shr_file_free_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            true,
            false,
            false,
            false,
            false,
            true,
            true,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": 6
      },
      "expected_output": {
        "error_code": 2,
        "error_msg": "reserved unit",
        "unit_tag_at_6": true
      },
      "metadata": {
        "type": "edge",
        "description": "Tests attempting to free reserved unit 6 (stdout), should fail with error code 2",
        "edge_cases": [
          "reserved_unit"
        ]
      }
    },
    {
      "name": "test_free_unit_not_in_use",
      "function": "shr_file_free_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": 50
      },
      "expected_output": {
        "error_code": 3,
        "error_msg": "unit not in use",
        "unit_tag_at_50": false
      },
      "metadata": {
        "type": "edge",
        "description": "Tests attempting to free a unit that is not currently in use, should fail with error code 3",
        "edge_cases": [
          "not_in_use"
        ]
      }
    },
    {
      "name": "test_free_unit_invalid_negative",
      "function": "shr_file_free_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": -5
      },
      "expected_output": {
        "error_code": 1,
        "error_msg": "invalid unit number",
        "unit_tag_unchanged": true
      },
      "metadata": {
        "type": "edge",
        "description": "Tests attempting to free an invalid negative unit number, should fail with error code 1",
        "edge_cases": [
          "invalid_negative"
        ]
      }
    },
    {
      "name": "test_free_unit_invalid_too_large",
      "function": "shr_file_free_unit",
      "inputs": {
        "state": {
          "unit_tag": [
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false,
            false
          ]
        },
        "unit": 150
      },
      "expected_output": {
        "error_code": 1,
        "error_msg": "invalid unit number",
        "unit_tag_unchanged": true
      },
      "metadata": {
        "type": "edge",
        "description": "Tests attempting to free a unit number beyond valid range (>99), should fail with error code 1",
        "edge_cases": [
          "invalid_too_large"
        ]
      }
    }
  ],
  "notes": "Test data generation assumptions:\n\n1. **FileUnitState Structure**: The unit_tag array is always length 100 (indices 0-99), with boolean values indicating unit allocation status.\n\n2. **Valid Unit Range**: Based on constraints, valid allocatable units are 10-99 (SHR_FILE_MIN_UNIT to SHR_FILE_MAX_UNIT).\n\n3. **Reserved Units**: Units 5 (stdin) and 6 (stdout) are reserved and cannot be allocated or freed. Unit 0 is also reserved for freeing operations.\n\n4. **Auto-allocation Strategy**: When unit=None, the function searches from highest (99) to lowest (10) for the first available unit.\n\n5. **Error Codes for shr_file_free_unit**:\n   - 0: Success\n   - 1: Invalid unit number (out of range 0-99)\n   - 2: Reserved unit (0, 5, or 6)\n   - 3: Unit not currently in use\n\n6. **Test Coverage**:\n   - Nominal cases: Initial state creation, successful allocations and frees\n   - Edge cases: Boundary values (10, 99), reserved units, already allocated units, invalid ranges\n   - Special cases: Partial allocation scenarios, auto-allocation with constraints\n\n7. **Physical Realism**: All boolean arrays represent valid state configurations. No NaN or Inf values are applicable for boolean arrays.\n\n8. **JIT Compilation**: The test data is suitable for both regular and JIT-compiled versions. The 'unit' parameter is marked as static for JIT compilation of shr_file_get_unit.\n\n9. **State Immutability**: Each function returns a new state rather than modifying the input state, following functional programming principles common in JAX."
}